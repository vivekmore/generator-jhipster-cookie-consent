name: Build
on: [ push, pull_request ]
jobs:
    generator-jhipster-cookie-consent:
        name: Build and Publish Code Coverage [Coveralls]
        runs-on: ${{ matrix.os }}
        timeout-minutes: 20
        strategy:
            fail-fast: false
            matrix:
                node_version: [ 16 ]
                # os: [ubuntu-latest, macos-latest, windows-latest]
                os: [ ubuntu-latest ]
        steps:
            # checkout the code
            -   uses: actions/checkout@v3

            # install node
            -   uses: actions/setup-node@v3
                with:
                    node-version: ${{ matrix.node-version }}

            # print last 10 commits
            -   name: Git History (last 10 commits)
                run: git --no-pager log -n 10 --graph --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue) <%an>%Creset' --abbrev-commit

            # run npm targets to capture coverage
            -   run: npm ci
            -   run: npm test
            -   run: npm run coverage

            # publish coverage at coveralls so the ReadMe can display the up-to-date coverage badge
            -   name: Publish Code Coverage
                uses: coverallsapp/github-action@master
                with:
                    github-token: ${{ secrets.GITHUB_TOKEN }}
